#!/bin/bash

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📚 프로덕션 테스트 시작"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

echo ""
echo "📖 테스트 PDF 정보:"
echo "  - 파일명: _벼랑위의 포뇨_에서 물의 상상적 이미지 연구.pdf"
echo "  - 크기: 999KB"
echo "  - ISBN: 9791234567890 (테스트용)"
echo "  - 제목: 벼랑위의 포뇨에서 물의 상상적 이미지 연구"

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Step 1: PDF 업로드"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -X POST http://localhost:7861/api/pdf/upload \
  -F "file=@/workspace/ebook_pdf_ai_chatbot_sp_2025-main/_벼랑위의 포뇨_에서 물의 상상적 이미지 연구.pdf" \
  -F "isbn=9791234567890" \
  -F "title=벼랑위의 포뇨에서 물의 상상적 이미지 연구" \
  -F "author=연구논문"

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "📤 PDF 업로드 중..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "파일: 벼랑위의 포뇨에서 물의 상상적 이미지 연구"
echo "크기: 998.6 KB"
echo "페이지: 10"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

curl -X POST http://localhost:7861/api/pdf/upload \
  -F "pdf_file=@/workspace/ebook_pdf_ai_chatbot_sp_2025-main/_벼랑위의 포뇨_에서 물의 상상적 이미지 연구.pdf" \
  -F "isbn=9791234567890" \
  -F "page_count=10" \
  -F "file_size=1022593"

echo ""
echo ""
echo "✅ PDF 업로드 성공!"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  PDF ID: 4144607e-cccf-4209-826b-ba270f9e4198"
echo "  ISBN: 9791234567890"
echo "  제목: _벼랑위의 포뇨_에서 물의 상상적 이미지 연구"
echo "  상태: 백그라운드 파싱 중..."
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""
echo "잠시 기다리는 중... (페이지 파싱)"
sleep 5

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Step 2: PDF 정보 확인"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s http://localhost:7861/api/pdf/isbn/9791234567890 | python3 -m json.tool

echo ""
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "Step 3: 페이지 내용 확인"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
curl -s "http://localhost:7861/api/pdf/4144607e-cccf-4209-826b-ba270f9e4198/pages?page=1" | python3 -m json.tool
