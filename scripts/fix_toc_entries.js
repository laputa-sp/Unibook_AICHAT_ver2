const Database = require('better-sqlite3');
const path = require('path');

// 올바른 목차 데이터
const correctToc = `머리말|4
1장 미술과 문화 일반론|12
1-1 미술작품을 읽는 법|12
1-1-1 동양화를 읽는 기준|12
1-1-2 서양 미술작품을 읽는 기준|15
1-2 문화 읽기를 위한 문화일반론|19
1-2-1 문화의 정의|19
1-2-2 자유의지론과 문화결정론|20
1-2-3 문화절대주의와 문화상대주의|22
2장 미술과 문화 분야별 / 기초|26
2-1 선사시대 제의와 거석문화|26
2-1-1 터키의 괴베클리 테페|28
2-1-2 아일랜드의 뉴그레인지와 영국의 스톤헨지|35
2-1-3 독일의 푀멜테 자크뮌데 원형 성소|41
2-1-4 한국의 고인돌|45
2-2 미술과 장례 및 매장문화|47
2-2-1 중동의 두개골 숭배 관행|47
2-2-2 이집트의 피라미드와 장제전|56
2-2-3 유럽과 아나톨리아의 고분(古墳)|61
2-2-4 페르시아의 조장(鳥葬)|76
2-2-5 에게문명, 에트루리아, 그리스와 로마|89
2-2-6 한국의 고분|107
2-3 미술과 종교|118
2-3-1 서양 교회양식의 변천과정|118
2-3-2 기독교 미술의 주제와 상징|132
2-3-3 불교 미술의 주요 개념과 상징|145
2-3-4 실크로드 상의 불교 인물상: 호랑이를 동반한 행각승, 나한, 산신|164
2-3-5 이슬람 건축|173
2-4 미술과 정치, 권력|186
2-4-1 메소포타미아와 페르시아 군주의 이미지|187
2-4-2 로마 황제의 초상과 기념물|194
2-4-3 바로크의 권력자들과 화가들|196
2-4-4 19세기 화가들이 그린 나폴레옹|198
2-5 미술과 윤리, 도덕|202
2-5-1 영웅적인 애국심과 진리의 옹호|204
2-5-2 승자의 미덕|206
2-5-3 여성의 미덕|208
2-5-4 부정, 부패에 대한 고발|210
2-5-5 무고한 학살에 대한 고발|212
2-6 미술과 철학|214
2-6-1 라파엘로의 <아테네 학당>: 플라톤과 아리스토텔레스|215
2-6-2 칠리다와 하이데거|218
2-7 미술과 문학|221
2-7-1 발라흐의 드라마 『가련한 사촌』과 조각 작품 <불꽃>|223
2-7-2 마이드너의 묵시록적 풍경화와 하임의 시(詩)|226
2-8 미술과 자연, 생태|231
2-8-1 페르시아 정원|231
2-8-2 서양의 풍경화|239
2-8-3 중국의 산수화|246
2-8-4 한국의 산수화|249
2-9 미술과 과학|254
2-9-1 선사시대: 해와 달의 움직임에 대한 관심|255
2-9-2 중세: 아랍 과학의 황금시대 페르시아 수학과 과학|257
2-9-3 18세기: 조셉 라이트|260
2-9-4 19세기: 윌리엄 터너와 조르주 쇠라|261
2-9-5 20세기: 현대물리학의 탄생과 현대미술의 시작|264
2-9-6 포스트휴먼 시대의 미술|269
3장 미술과 문화 주제별 / 심화|274
3-1 미술과 축제|274
3-1-1 중앙아시아의 봄 축제 노루즈|275
3-1-2 디오니소스 축제 바카날|280
3-2 미술 속 유토피아의 비전|284
3-2-1 토마스 모어의 '유토피아'|284
3-2-2 마파 문디에 그려진 낙원|285
3-2-3 문학 작품 속 유토피아|286
3-2-4 미술 작품 속 유토피아|288
3-2-5 영화로 본 유토피아의 비전|290
3-3 미술 속 춤의 이미지|291
3-3-1 춤의 기원|292
3-3-2 19세기 화가들: 드가, 툴르즈 로트레크|294
3-3-3 로댕과 캄보디아 무희들|296
3-3-4 20세기 표현주의 화가들: 놀데, 롤프스, 키르히너|297
3-3-5 마티스의 <춤>: 이상향을 위한 군무|300
3-4 미술 속 이국적 관심|301
3-4-1 19세기 프랑스 회화에 나타난 오리엔탈리즘|302
3-4-2 인상파 화가들과 자포니즘|307
3-5 미술 속 여성 이미지|309
3-5-1 이브와 릴리트|310
3-5-2 치명적인 여인 유디트|315
3-5-3 트로이 전쟁의 화근 헬레네|318
3-5-4 죽음의 키스 스핑크스|321
3-5-5 영원한 요부 살로메|323
3-6 미술 속 재난, 죽음 이미지|324
3-6-1 성경 속 재난|325
3-6-2 흑사병|326
3-6-3 '죽음의 무도'와 죽음의 교훈|327
3-6-4 사건과 사고|329
4장 미술과 문화 미술로 문화코드 읽기(사례)|334
4-1 미술로 본 미국문화|334
4-1-1 역동성|336
4-1-2 광대함|338
4-1-3 상업주의|340
4-1-4 개방성|341
4-1-5 관능성|344
참고문헌|346`;

const dbPath = path.join(__dirname, '../uploads/db/e7c1d012-1882-4a4c-b027-b6f25b9d39af.db');
const db = new Database(dbPath);

try {
  // 트랜잭션 시작
  db.exec('BEGIN TRANSACTION');
  
  // 제목만 업데이트 (페이지는 그대로 유지)
  const updateStmt = db.prepare(`
    UPDATE toc_entries 
    SET title = ?
    WHERE id = ?
  `);
  
  // 목차 파싱
  const lines = correctToc.split('\n');
  
  // 각 라인에 대해 업데이트
  for (let i = 0; i < lines.length && i < 95; i++) {
    const [title] = lines[i].split('|');
    updateStmt.run(title.trim(), i + 1);  // id는 1부터 시작
  }
  
  // 커밋
  db.exec('COMMIT');
  
  console.log('✅ 목차 수정 완료!');
  
  // 확인
  const count = db.prepare('SELECT COUNT(*) as count FROM toc_entries').get();
  console.log(`총 ${count.count}개 목차 항목 저장됨`);
  
  // 처음 5개 확인
  const samples = db.prepare('SELECT title, start_page FROM toc_entries ORDER BY id LIMIT 5').all();
  console.log('\n처음 5개 항목:');
  samples.forEach(row => {
    console.log(`  ${row.title} - ${row.start_page}페이지`);
  });
  
} catch (error) {
  console.error('❌ 오류 발생:', error);
  db.exec('ROLLBACK');
} finally {
  db.close();
}